<nav class="navbar navbar-expand-lg fixed-top shadow-sm px-4 py-2 ">
  <div class="container-fluid">
    <!-- Botón hamburguesa que activa el offcanvas -->
    <button class="btn btn-outline-secondary me-2" type="button" data-bs-toggle="offcanvas"
      data-bs-target="#offcanvasMenu" aria-controls="offcanvasMenu">
      <i class="bi bi-list fs-4"></i>
    </button>

    <!-- Logo -->
    <a class="navbar-brand fw-bold me-3" routerLink="/" (click)="selectItem('Todo');">
      <span class="d-none d-sm-inline">Importadora</span>
      <span class="d-inline d-sm-none">Import.</span> Paola
    </a>


    <!-- Íconos para móviles -->
    <div class="d-flex flex-column gap-3 d-md-none">
      <div class="d-flex justify-content-around">
        <a routerLink="/wishlist" class="btn position-relative p-0 me-3">
          <i class="bi bi-heart-fill fs-5"></i>
          <span *ngIf="favoritesCount > 0" class="position-absolute top-0 start-100 translate-middle badge bg-danger"
            style="font-size: 0.75rem; padding: 0.25em 0.4em;">
            {{ favoritesCount }}
          </span>
        </a>
        <a (click)="goToShop()" class="btn position-relative p-0">
          <i class="bi bi-cart-fill fs-5"></i>
          <span *ngIf="cartCount > 0" class="position-absolute top-0 start-100 translate-middle badge bg-danger"
            style="font-size: 0.75rem; padding: 0.25em 0.4em;">
            {{ cartCount }}
          </span>
        </a>
      </div>
    </div>


    <!-- Buscador -->
    <div class="d-none d-md-flex flex-grow-1 me-3">
      <div class="input-group">
        <input
          type="text"
          class="form-control search-input border-start-0"
          placeholder="Buscar productos..."
          [value]="searchTerm()"
          (keyup.enter)="onSearch()"
          (input)="searchTerm.set($any($event.target).value)"
          required
        />
        <button
          type="button"
          class="input-group-text bg-white border-end-0"
          (click)="onSearch()"
        >
          <i class="bi bi-search"></i>
        </button>
      </div>
    </div>




    <!-- Íconos y botones Escritorio-->
    <div class="d-none d-md-flex align-items-center gap-3">
      <a routerLink="/wishlist" class="btn position-relative p-0 text-decoration-none">
        <i class="bi bi-heart-fill fs-5"></i>
        <span *ngIf="favoritesCount > 0" class="position-absolute top-0 start-100 translate-middle badge bg-danger"
          style="font-size: 0.75rem; padding: 0.25em 0.4em;">
          {{ favoritesCount }}
        </span>
      </a>

      <a (click)="goToShop()" class="btn position-relative p-0">
        <i class="bi bi-cart-fill fs-5"></i>
        <span *ngIf="cartCount > 0" class="position-absolute top-0 start-100 translate-middle badge bg-danger"
          style="font-size: 0.75rem; padding: 0.25em 0.4em;">
          {{ cartCount }}
        </span>
      </a>
      <!-- Botón que abre el modal PC -->
      <div *ngIf="!isLoggedIn()" class="d-none d-md-flex align-items-center gap-3">
        <a class="text-decoration-none" data-bs-toggle="modal" data-bs-target="#signInModal">Acceder</a>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#signUpModal">Regístrate</button>
      </div>

      <div *ngIf="isLoggedIn()" class="d-none d-md-flex align-items-center gap-3">
        <div class="btn-group">
          <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
            {{ (currentUser()?.email) || 'Usuario' }}
          </button>

          <ul class="dropdown-menu">
            <li><span class="d-none d-sm-inline m-4">Bienvenido, {{ currentUser()?.nombres?.split(' ')?.[0] || ''
                }}</span></li>
            <li>
              <hr class="dropdown-divider">
            </li>
            <li>
              <a class="dropdown-item d-flex align-items-center gap-2" href="javascript:void(0)" (click)="onLogout()">
                <i class="bi bi-box-arrow-right"></i>
                Cerrar Sesión
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</nav>

<!-- Offcanvas Menu -->
<div class="offcanvas offcanvas-start offcanvas-movil" tabindex="-1" id="offcanvasMenu"
  aria-labelledby="offcanvasMenuLabel">
  <div class="offcanvas-header">
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body p-3">
    <!-- Perfil Usuario -->
    <div *ngIf="isLoggedIn()" class="user-profile d-flex align-items-center mb-4">
      <div class="user-icon rounded-circle text-white d-flex justify-content-center align-items-center me-3"
        style="background-color: #e5e5e5;">
        <i class="bi bi-person fs-1"></i>
      </div>
      <div>
        <h6 class="mb-0 fw-bold">
          {{ currentUser()?.nombres?.split(' ')?.[0] || '' }} {{ currentUser()?.apellidos?.split(' ')?.[0] || '' }}
        </h6>
        <small class="text-muted">{{ currentUser()?.rol }}</small>
      </div>
    </div>
    <hr>
    <!-- Administrador -->
    <div *ngIf="currentUser()?.rol === 'administrador'">
      <h6 class="text-uppercase fw-bold text-muted mb-3 mt-4">Administración</h6>
      <ul class="list-group list-group-flush">
        <li routerLink="/inventory" (click)="selectItem('inventario'); closeOffcanvas()"
          [class.active-item]="selected === 'inventario'" class="list-group-item px-0 py-2 ps-2 border-bottom">
          Inventario
          de Productos</li>
        <li routerLink="/form" (click)="selectItem('Nuevo'); closeOffcanvas()"
          [class.active-item]="selected === 'Nuevo'" class="list-group-item px-0 py-2 ps-2 border-bottom">Nuevo Producto
        </li>
        <li routerLink="/orders" (click)="selectItem('orders'); closeOffcanvas()"
          [class.active-item]="selected === 'orders'" class="list-group-item px-0 py-2 ps-2 border-bottom">Pedidos
          Recibidos</li>
        <li routerLink="/categories" (click)="selectItem('categories'); closeOffcanvas()"
          [class.active-item]="selected === 'categories'" class="list-group-item px-0 py-2 ps-2 border-bottom">
          Administrar
          Categorías</li>
      </ul>
    </div>
    <!-- Cliente -->
    <div *ngIf="currentUser()?.rol === 'cliente'">
      <h6 class="text-uppercase fw-bold text-muted mb-3 mt-4">Menu</h6>
      <ul class="list-group list-group-flush">
         <li class="list-group-item px-0 py-2 ps-2 border-bottom">Perfil</li>
        <li class="list-group-item px-0 py-2 ps-2 border-bottom">Mis Pedidos</li>
      </ul>
    </div>
    <!-- Categorías -->
    <h6 class="text-uppercase fw-bold text-muted mb-3 mt-4">Categorías</h6>
    <ul class="list-group list-group-flush">
      <li routerLink="/" (click)="selectItem('Todo'); closeOffcanvas()" [class.active-item]="selected === 'Todo'"
        class="list-group-item px-0 py-2 ps-2 border-bottom">Todo</li>
      <li *ngFor="let categoria of categorias()"
          routerLink="categorias/{{ categoria.nombre }}/{{ categoria.categoria_id }}"
          (click)="selectItem(categoria.nombre); closeOffcanvas()" [class.active-item]="selected === categoria.nombre"
          class="list-group-item px-0 py-2 ps-2 border-bottom">
        {{ this.utilsService.getCategoriaNombre(categoria.nombre) }}
      </li>
    </ul>
    <div class="d-flex flex-column gap-3 d-md-none">
      <form class="mt-3">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Buscar productos..." />
          <span class="input-group-text"><i class="bi bi-search"></i></span>
        </div>
      </form>
      <div class="d-flex ms-auto">
        <!-- Botón que abre el modal movil -->
        <div *ngIf="!isLoggedIn()" class="">
          <a class="text-decoration-none me-2" data-bs-toggle="modal" data-bs-target="#signInModal">Acceder</a>
          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#signUpModal">Regístrate</button>
        </div>
        <div *ngIf="isLoggedIn()">
          <button type="button" class="btn btn-secondary" href="javascript:void(0)" (click)="onLogout()">
            <i class="bi bi-box-arrow-right text-white"></i>
            Cerrar Sesión
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
