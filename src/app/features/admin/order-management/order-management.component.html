<div class="container mt-4">
  <div class="form-header mb-4">
    <div class="back-link-container mb-3">
      <a href="#" class="back-link d-inline-flex align-items-center fw-semibold px-3 py-2 rounded">
        <i class="bi bi-arrow-left me-2"></i>
        Volver a Productos
      </a>
    </div>
    <!-- Encabezado -->
    <div class="page-header">
      <h1 class="page-title">
        <i class="bi bi-cart-check"></i>
        Gestión de Pedidos
      </h1>

      <!-- Tarjetas resumen -->
      <div class="stats-cards">
        <div class="stat-card">
          <div class="stat-label">Total Pedidos</div>
          <div class="stat-value">{{totalOrders}}</div>
        </div>
        <div class="stat-card success">
          <div class="stat-label">Entregados</div>
          <div class="stat-value">{{deliveredOrders}}</div>
        </div>
        <div class="stat-card warning">
          <div class="stat-label">Pendientes</div>
          <div class="stat-value">{{pendingOrders}}</div>
        </div>
        <div class="stat-card info">
          <div class="stat-label">En Proceso</div>
          <div class="stat-value">{{inProcessOrders}}</div>
        </div>
      </div>
    </div>

    <!-- Tabla de pedidos -->
    <div class="table-card">
      <div class="table-header">
        <h5 class="mb-0">Lista de Pedidos Recientes</h5>
        <div class="search-box">
          <input type="text" class="form-control"
                 placeholder="Buscar por nombre o id pedido..."
                 (input)="onSearch($event)"
                  [value]="searchTerm()">
        </div>
        <!-- Select para ordenar por estado -->
        <div class="d-flex align-items-center gap-2">
          <label for="estadoSelect" class="form-label mb-0">Ordenar por Estado:</label>
          <select id="estadoSelect"
                  class="form-select form-select-sm"
                  (change)="onStatusChange($event)"
                  (click)="this.searchTerm.set('');"
                  [(ngModel)]="selectedStatus">
            <option value="all">Todos</option>
            <option value="Pendiente">Pendiente</option>
            <option value="EnPreparacion">Preparando</option>
            <option value="Listo">Listo para retiro</option>
            <option value="Entregado">Entregado</option>
            <option value="Cancelado">Cancelado</option>
          </select>
        </div>
      </div>

      <!-- Table -->
      <div class="table-responsive">
        <table class="table orders-table">
          <thead>
            <tr>
              <th>ID Pedido</th>
              <th>Cliente</th>
              <th>Fecha</th>
              <th>SubTotal</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let order of filteredOrders | paginate: { itemsPerPage: itemsPerPage, currentPage: p }">
              <!-- ID del pedido -->
              <td>
                <span class="order-id">#ORD-{{ order.pedido_id.toString().padStart(4, '0') }}</span>
              </td>
              <!-- Información del cliente -->
              <td>
                <div class="customer-info">
                  <!-- Avatar: iniciales del nombre y apellido -->
                  <div class="customer-avatar">
                    {{ order.usuario?.nombres?.charAt(0) }}{{ order.usuario?.apellidos?.charAt(0) }}
                  </div>
                  <div class="customer-details">
                    <span class="customer-name">
                      {{ formatName(order.usuario?.nombres!,order.usuario?.apellidos!)}}
                    </span>
                    <span class="customer-phone">
                      <i class="bi bi-telephone"></i>
                      {{ formatPhone(order.usuario?.telefono!) }}
                    </span>
                  </div>
                </div>
              </td>

              <!-- Fecha del pedido -->
              <td class="order-date">
                {{ order.fecha_pedido | date:'dd MMM yyyy':'':'es-CL' }}
              </td>

              <!-- Total -->
              <td>
                <span class="order-price">
                  ${{ order.total| number:'1.0-0':'es-CL' }}
                </span>
              </td>

              <!-- Estado -->
              <td>
                <span class="status-badge {{ statusConfig[order.estado.toLowerCase()]?.class }}">
                  <i class="bi {{ statusConfig[order.estado.toLowerCase()]?.icon }}"></i>
                  {{ statusConfig[order.estado.toLowerCase()]?.label }}
                </span>
              </td>

              <!-- Acción -->
              <td>
                <button [routerLink]="['/orderDetail', order.pedido_id]" class="btn btn-view btn-action">
                  <i class="bi bi-eye"></i> Ver Detalle
                </button>
              </td>
            </tr>

          </tbody>
        </table>
      </div>

      <!-- Table Footer with Pagination -->
      <div class="table-footer">
        <div class="mt-4 d-flex justify-content-center">
          <pagination-controls
            (pageChange)="onPageChange($event)"
            previousLabel="Ant."
            nextLabel="Sig.">
          </pagination-controls>
        </div>
      </div>

    </div>
  </div>
